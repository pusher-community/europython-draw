<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>EuroPython2016</title>
    <meta name="viewport" content="initial-scale=1">
    <style media="screen">
    html, body {
      margin:0
    }
    svg {
      position: absolute;
      width: 100%;
      height: 100%;
      width: 100vw;
      height: 100vh;
    }

    path{
      transition: fill .15s;
    }

    #say {
      display:none; position: absolute; font-size: 5em; font-family: monospace; text-align: center; z-index: 1; padding: 1em 0; right:0; left:0; bottom:0; top:0; background: rgba(255,255,255,0.8);
    }
    </style>
  </head>
  <body>
     <div id="say"></div><svg viewBox="0 0 130 130" preserveAspectRatio="xMidYMid meet" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://web.resource.org/cc/" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sodipodi="http://inkscape.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" version="1.0" id="svg" sodipodi:version="0.32" inkscape:version="0.43" sodipodi:docname="logo-python-generic.svg" sodipodi:docbase="/home/sdeibel"> <metadata id="metadata2193"> <rdf:RDF> <cc:Work rdf:about=""> <dc:format>image/svg+xml</dc:format> <dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/> </cc:Work> </rdf:RDF> </metadata> <defs> <linearGradient id="linearGradient4671"> <stop style="stop-color:#ffd43b;stop-opacity:1" offset="0" id="stop-4"/> <stop style="stop-color:#ffe873;stop-opacity:1" offset="1" id="stop-3"/> </linearGradient> <linearGradient id="linearGradient4689"> <stop style="stop-color:#5a9fd4;stop-opacity:1" offset="0" id="stop-1"/> <stop style="stop-color:#306998;stop-opacity:1" offset="1" id="stop-2"/> </linearGradient> <linearGradient x1="150.96111" y1="192.35176" x2="112.03144" y2="137.27299" id="linearGradient1475" xlink:href="#linearGradient4671" gradientUnits="userSpaceOnUse" gradientTransform="matrix(0.562541,0,0,0.567972,-9.399749,-5.305317)"/> <linearGradient x1="26.648937" y1="20.603781" x2="135.66525" y2="114.39767" id="linearGradient1478" xlink:href="#linearGradient4689" gradientUnits="userSpaceOnUse" gradientTransform="matrix(0.562541,0,0,0.567972,-9.399749,-5.305317)"/> </defs> <g id="g2303"> <path id="logo-top" style="fill:url(#linearGradient1478);fill-opacity:1" d="M 60.510156,6.3979729 C 55.926503,6.4192712 51.549217,6.8101906 47.697656,7.4917229 C 36.35144,9.4962267 34.291407,13.691825 34.291406,21.429223 L 34.291406,31.647973 L 61.103906,31.647973 L 61.103906,35.054223 L 34.291406,35.054223 L 24.228906,35.054223 C 16.436447,35.054223 9.6131468,39.73794 7.4789058,48.647973 C 5.0170858,58.860939 4.9078907,65.233996 7.4789058,75.897973 C 9.3848341,83.835825 13.936449,89.491721 21.728906,89.491723 L 30.947656,89.491723 L 30.947656,77.241723 C 30.947656,68.391821 38.6048,60.585475 47.697656,60.585473 L 74.478906,60.585473 C 81.933857,60.585473 87.885159,54.447309 87.885156,46.960473 L 87.885156,21.429223 C 87.885156,14.162884 81.755176,8.7044455 74.478906,7.4917229 C 69.872919,6.7249976 65.093809,6.3766746 60.510156,6.3979729 z M 46.010156,14.616723 C 48.779703,14.616723 51.041406,16.915369 51.041406,19.741723 C 51.041404,22.558059 48.779703,24.835473 46.010156,24.835473 C 43.23068,24.835472 40.978906,22.558058 40.978906,19.741723 C 40.978905,16.91537 43.23068,14.616723 46.010156,14.616723 z "/> <path id="logo-bottom" style="fill:url(#linearGradient1475);fill-opacity:1" d="M 91.228906,35.054223 L 91.228906,46.960473 C 91.228906,56.191228 83.403011,63.960472 74.478906,63.960473 L 47.697656,63.960473 C 40.361823,63.960473 34.291407,70.238956 34.291406,77.585473 L 34.291406,103.11672 C 34.291406,110.38306 40.609994,114.65704 47.697656,116.74172 C 56.184987,119.23733 64.323893,119.68835 74.478906,116.74172 C 81.229061,114.78733 87.885159,110.85411 87.885156,103.11672 L 87.885156,92.897973 L 61.103906,92.897973 L 61.103906,89.491723 L 87.885156,89.491723 L 101.29141,89.491723 C 109.08387,89.491723 111.98766,84.056315 114.69765,75.897973 C 117.49698,67.499087 117.37787,59.422197 114.69765,48.647973 C 112.77187,40.890532 109.09378,35.054223 101.29141,35.054223 L 91.228906,35.054223 z M 76.166406,99.710473 C 78.945884,99.710476 81.197656,101.98789 81.197656,104.80422 C 81.197654,107.63057 78.945881,109.92922 76.166406,109.92922 C 73.396856,109.92922 71.135156,107.63057 71.135156,104.80422 C 71.135158,101.98789 73.396853,99.710473 76.166406,99.710473 z "/> </g> </svg>
   <script type="text/javascript">
// UI CODE

(function(){0=="performance"in window&&(window.performance={});Date.now=Date.now||function(){return(new Date).getTime()};if(0=="now"in window.performance){var a=Date.now();performance.timing&&performance.timing.navigationStart&&(a=performance.timing.navigationStart);window.performance.now=function(){return Date.now()-a}}})();

function _colours(a,b) {document.getElementById("logo-top").style.fill=a;document.getElementById("logo-bottom").style.fill=b}
function reset() {_colours("#eee","#eee");text("")}_colours("#eee","#eee");
function color()
{_colours("hsl("+Math.floor(360*Math.random())+", 90%, 50%)","hsl("+Math.floor(360*Math.random())+", 90%, 50%)")}
function text(a){var b=document.getElementById("say");b.style.display=a?"block":"none";b.innerText=a};

var play=function(){var e=[880,783.99,698.46,659.26,587.33,523.25,493.88];window.AudioContext=window.AudioContext||window.webkitAudioContext;window.context=parent.context||new AudioContext;return function(c,d){c=c||e[Math.floor(Math.random()*e.length)];d=d||.8;var b=context.createOscillator();b.frequency.value=Math.round(c);var a=context.createGain();a.gain.value=1E-4;now=context.currentTime;a.gain.cancelScheduledValues(now);a.gain.exponentialRampToValueAtTime(d,now+.25);a.gain.exponentialRampToValueAtTime(1E-4,
now+2);a.gain.setTargetAtTime(1E-4,now+4,1E-4);b.connect(a);a.connect(context.destination);b.start(0);setTimeout(function(){b.stop(0);b.disconnect();a.disconnect()},2500)}}();

var _schedule = []
// look for any scheduled items, and pass
function _process_schedule(t){
  if(_schedule.length) {
    _schedule = _schedule.filter(function(s){
      if(s.t < t) {
        s.fn()
      } else {
        return true
      }
    })
  }
  requestAnimationFrame(_process_schedule)
}
requestAnimationFrame(_process_schedule)


function schedule(is_winner) {
  var now = window.performance.now()
  _schedule = [
    t(1000,0.4),
    t(1000,0.4),
    t(800,0.4),
    t(800,0.5),
    t(800,0.4), t(800,0.5), t(800,0.5), t(800,0.5), t(800,0.5), t(800,0.5), t(800,0.6), t(500,0.6), t(500,0.6), t(500,0.6), t(500,0.6), t(500,0.6), t(500,0.6), t(400,0.7), t(400,0.7), t(400,0.7), t(400,0.7), t(400,0.7), t(400,0.7), t(400,0.7), t(400,0.7), t(400,0.7), t(400,0.7), t(400,0.7), t(400,0.7), t(400,0.7), t(400,0.7), t(400,0.7), t(400,0.7),
    t(400,0.7),
    t(400,0.7), t(400,0.7), t(400,0.7), t(400,0.7), t(400,0.7), t(400,0.7), t(400,0.7), t(400,0.7), t(400,0.7), t(400,0.7), t(400,0.7), t(400,0.7),
    t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7),
    t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7),
    t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7),
    t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7),
    t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7),
    t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7), t(200,0.7),
    t(200,0.7), t(300,0.7), t(400,0.7), t(500,0.7), t(600,0.7), t(700,0.7), t(800,0.7), t(900,0.7),
    {t: 1000, fn: function(){
      reset()
      if(is_winner) {
        win()
      } else {
        lose()
      }
    }}
  ].map(function(item){
    item.t = (now += item.t)
    return item
  })
  function t(x,y) {
    return {t: x, fn: function(){
      color()
      play()
    }}
  }
}

function lose() {
  _colours('#ccc', '#ccc')
  text('')
}

function win() {
  text("You've WON!")
  _colours("url(#linearGradient1478)","url(#linearGradient1475)")
}


// start audio context on ios
var iosHack = function(){
  play(false, 0.001)
  document.removeEventListener('touchstart', iosHack)
}
document.addEventListener('touchstart', iosHack, false)


     </script>

    <script src="https://js.pusher.com/3.1/pusher.min.js"></script>

    <script>

    // Enable pusher logging - don't include this in production
    Pusher.logToConsole = true;

      var pusher = new Pusher('87d7bf07035146dd4fa7', {
        cluster: 'eu',
        encrypted: true
      })

      var channel = pusher.subscribe('presence-demo');

      channel.bind('color', function(){
        color()
      })

      channel.bind('set-color-top', function(data){
        document.getElementById("logo-top").style.fill = data.value
      })

      channel.bind('set-color-bottom', function(data){
        document.getElementById("logo-bottom").style.fill = data.value
      })

      channel.bind('sound', function(){
        color()
        play()
      })
      channel.bind('reload', function(){
        window.location.reload()
      })
      channel.bind('reset', function(){
        _schedule = []
        reset()
      })

      channel.bind('quick-win', function(data) {
        _schedule = []
        reset()
        if(data.id == channel.members.myID) {
          win()
        } else {
          lose()
        }
      })

      channel.bind('win', function(data) {
        reset()
        schedule(data.id == channel.members.myID)
      })

    </script>

  </body>
</html>
